name: Daily Stock Monitor

on:
  schedule:
    # âš ï¸ GitHub ä½¿ç”¨ UTC æ—¶é—´ï¼Œæ¯”åŒ—äº¬æ—¶é—´æ…¢ 8 å°æ—¶
    # 1. åŒ—äº¬ 07:00 (æ—©æŠ¥/ç¾è‚¡æ”¶ç›˜) -> UTC 23:00 (å‰ä¸€å¤©)
    - cron: '0 23 * * *'
    
    # 2. åŒ—äº¬ 12:00 (åˆè¯„/Aè‚¡ä¼‘å¸‚) -> UTC 04:00
    - cron: '0 4 * * *'
    
    # 3. åŒ—äº¬ 20:00 (å¤ç›˜/ç¾è‚¡ç›˜å‰) -> UTC 12:00
    - cron: '0 12 * * *'

  # å…è®¸æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è§¦å‘ (ä¿æŒä¸å˜)
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    # ğŸ”¥ æ–°å¢ï¼šè¶…æ—¶ä¿æŠ¤
    # é˜²æ­¢ API å¡ä½å¯¼è‡´è„šæœ¬ä¸€ç›´è·‘ï¼Œæµªè´¹é¢åº¦ã€‚è¶…è¿‡ 10 åˆ†é’Ÿè‡ªåŠ¨å¼ºåˆ¶åœæ­¢
    timeout-minutes: 10
    
    permissions:
      contents: write
      pages: write
      id-token: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        # ğŸ”¥ æ–°å¢ï¼šç¼“å­˜ä¾èµ–
        # è¿™æ ·ä¸‹ä¸€æ¬¡è¿è¡Œå°±ä¸ç”¨é‡æ–°ä¸‹è½½ pandas ç­‰å¤§æ–‡ä»¶ï¼Œé€Ÿåº¦æ›´å¿«
        cache: 'pip' 
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Run data collection and analysis
      env:
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
        TO_EMAIL: ${{ secrets.TO_EMAIL }}
      run: python main.py
      
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        personal_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        publish_dir: ./docs
        publish_branch: gh-pages
